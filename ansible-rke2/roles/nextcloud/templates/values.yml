mariadb:
  enabled: true
  architecture: standalone

  auth:
    existingSecret: nextcloud-secrets
    username: nextcloud
    database: nextcloud

  primary:
    persistence:
      enabled: true
      existingClaim: nextcloud-mariadb   # <-- must match the PVC you created in Ansible
      accessModes:
        - ReadWriteOnce
      size: 50Gi             # Helm chart still needs a size, but your PVC spec wins
      storageClass: "rwo"       # blank since weâ€™re binding manually
  containerSecurityContext:
    runAsUser: 0
    runAsGroup: 0
    fsGroup: 0
  image:
    registry: docker.io
    repository: bitnamilegacy/mariadb
    tag: 12.0.2-debian-12-r0

nextcloud:
  host: 192.168.0.222         
  existingSecret:
    enabled: true
    secretName: nextcloud-secrets
    usernameKey: username
    passwordKey: password
  resources:
    requests:
      cpu: 250m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 1Gi
  trustedDomains:             
    - 192.168.0.222
    - cloud.chaoscauldron.space
    - nextcloud.default.svc
    - nextcloud.default.svc.cluster.local
  podSecurityContext:
    fsGroup: 0
    runAsUser: 0
    runAsGroup: 33
  redis:
    enabled: true
livenessProbe:
  enabled: true
  initialDelaySeconds: 120
  periodSeconds: 30
  timeoutSeconds: 10
  failureThreshold: 10

readinessProbe:
  enabled: true
  initialDelaySeconds: 120
  periodSeconds: 30
  timeoutSeconds: 10
  failureThreshold: 10
startupProbe:
  enabled: true
  initialDelaySeconds: 120
  periodSeconds: 30
  timeoutSeconds: 10
  failureThreshold: 10
persistence:
  enabled: true
  existingClaim: nextcloud-data
  accessMode: ReadWriteMany
  size: 2Ti
  storageClass: "rwx"  
  name: nextcloud-data
              
 
service:
  type: LoadBalancer
  loadBalancerIP: 192.168.0.222
  port: 80
  targetPort: 80

ingress:
  enabled: false

# force Nextcloud to always run on worker1
nodeSelector:
  kubernetes.io/hostname: worker1

externalDatabase:
  enabled: true
  type: mysql
  host: nextcloud-mariadb
  user: nextcloud
  database: nextcloud
  existingSecret:
    enabled: true
    secretName: nextcloud-secrets
    usernameKey: db-username
    passwordKey: password

internalDatabase:
  enabled: false

redis:
  enabled: true
  architecture: standalone
  image:
    registry: docker.io
    repository: bitnamilegacy/redis
    tag: 8.2.1-debian-12-r0

  auth:
    enabled: false   # keep it simple at first; you can add a password later

  master:
    persistence:
      enabled: false
      storageClass: rwo
      size: 5Gi
      accessModes:
        - ReadWriteOnce
      existingClaim: "nextcloud-redis"  
    configuration: |
      loglevel verbose

global:
  security:
    allowInsecureImages: true